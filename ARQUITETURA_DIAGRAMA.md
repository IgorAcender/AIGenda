# ðŸŽ¨ DIAGRAMA DA ARQUITETURA - SISTEMA DE AGENDAMENTO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENTE (Navegador)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      FRONTEND (Next.js + React)         â”‚
        â”‚  apps/web/src/                          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                         â”‚
        â”‚  /agendar/[tenantSlug]/                 â”‚
        â”‚  â”œâ”€ ServiceSelector.tsx    (Fase 1)     â”‚
        â”‚  â”œâ”€ DateTimeSelector.tsx   (Fase 2)     â”‚
        â”‚  â”œâ”€ BookingForm.tsx        (Fase 3)     â”‚
        â”‚  â””â”€ Success.tsx            (ConfirmaÃ§Ã£o)â”‚
        â”‚                                         â”‚
        â”‚  /meus-agendamentos/                    â”‚
        â”‚  â”œâ”€ ListBookings.tsx       (Consultar) â”‚
        â”‚  â”œâ”€ CancelBooking.tsx      (Cancelar)  â”‚
        â”‚  â””â”€ RescheduleBooking.tsx  (Reagendar) â”‚
        â”‚                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP API
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     BACKEND API (Node.js + TypeScript)  â”‚
        â”‚     apps/api/src/                       â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                         â”‚
        â”‚  ðŸ“ ROTAS (Express)                     â”‚
        â”‚  â”œâ”€ POST   /bookings                    â”‚
        â”‚  â”œâ”€ GET    /bookings                    â”‚
        â”‚  â”œâ”€ PATCH  /bookings/:id/cancel         â”‚
        â”‚  â”œâ”€ PATCH  /bookings/:id/reschedule     â”‚
        â”‚  â”œâ”€ GET    /available-slots             â”‚
        â”‚  â””â”€ GET    /professionals/:serviceId    â”‚
        â”‚                                         â”‚
        â”‚  ðŸ”§ SERVIÃ‡OS (Services)                 â”‚
        â”‚  â”œâ”€ availability.service.ts             â”‚
        â”‚  â”‚  â”œâ”€ getAvailableSlots()              â”‚
        â”‚  â”‚  â”œâ”€ checkSlotAvailability()          â”‚
        â”‚  â”‚  â””â”€ getProfessionalsForService()     â”‚
        â”‚  â”‚                                      â”‚
        â”‚  â””â”€ notification.service.ts             â”‚
        â”‚     â”œâ”€ sendBookingConfirmation()        â”‚
        â”‚     â””â”€ sendReminder()                   â”‚
        â”‚                                         â”‚
        â”‚  ðŸ“‹ VALIDAÃ‡Ã•ES                          â”‚
        â”‚  â”œâ”€ Disponibilidade de horÃ¡rios         â”‚
        â”‚  â”œâ”€ Conflito de agendamentos            â”‚
        â”‚  â”œâ”€ PolÃ­ticas de cancelamento           â”‚
        â”‚  â””â”€ PolÃ­ticas de reagendamento          â”‚
        â”‚                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Prisma ORM
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    BANCO DE DADOS (PostgreSQL)          â”‚
        â”‚    apps/api/prisma/                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                         â”‚
        â”‚  Tenant (Multi-tenancy)                 â”‚
        â”‚  â”œâ”€ bookingPolicy: BookingPolicy[]      â”‚
        â”‚  â””â”€ ...                                 â”‚
        â”‚                                         â”‚
        â”‚  ðŸ“… BookingPolicy (NOVO)                â”‚
        â”‚  â”œâ”€ tenantId        (FK)                â”‚
        â”‚  â”œâ”€ allowCancellation                   â”‚
        â”‚  â”œâ”€ minCancellationHours                â”‚
        â”‚  â”œâ”€ allowRescheduling                   â”‚
        â”‚  â”œâ”€ minReschedulingHours                â”‚
        â”‚  â”œâ”€ maxAdvanceBookingDays               â”‚
        â”‚  â”œâ”€ slotDurationMinutes                 â”‚
        â”‚  â””â”€ ...                                 â”‚
        â”‚                                         â”‚
        â”‚  ðŸ• AvailabilityRule (NOVO)             â”‚
        â”‚  â”œâ”€ professionalId  (FK)                â”‚
        â”‚  â”œâ”€ dayOfWeek       (0-6)               â”‚
        â”‚  â”œâ”€ startTime       ("09:00")           â”‚
        â”‚  â”œâ”€ endTime         ("18:00")           â”‚
        â”‚  â””â”€ isActive                            â”‚
        â”‚                                         â”‚
        â”‚  ðŸ“ Appointment (ESTENDIDO)             â”‚
        â”‚  â”œâ”€ Campos originais                    â”‚
        â”‚  â”œâ”€ customerPhone   (NOVO)              â”‚
        â”‚  â”œâ”€ customerEmail   (NOVO)              â”‚
        â”‚  â”œâ”€ originalAppointmentId (NOVO)        â”‚
        â”‚  â”œâ”€ cancelledAt     (NOVO)              â”‚
        â”‚  â”œâ”€ cancellationReason (NOVO)           â”‚
        â”‚  â”œâ”€ confirmedAt     (NOVO)              â”‚
        â”‚  â”œâ”€ confirmationToken (NOVO)            â”‚
        â”‚  â”œâ”€ rating         (NOVO)               â”‚
        â”‚  â””â”€ review         (NOVO)               â”‚
        â”‚                                         â”‚
        â”‚  Professional / Service / Client        â”‚
        â”‚  (Modelos existentes)                   â”‚
        â”‚                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ FLUXO DE AGENDAMENTO (Passo-a-passo)

```
PASSO 1: SELEÃ‡ÃƒO DE SERVIÃ‡O
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UsuÃ¡rio               Frontend                  Backend
    â”‚                    â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Seleciona serviÃ§o        â”‚
    â”‚                    â”‚                         â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ GET /services
    â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Lista serviÃ§os
    â”‚                    â”‚                         â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ GET /professionals/:serviceId
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Filtra profissionais
    â”‚ VÃª profissionais   â”‚                         â”‚
    â”‚                    â”‚                         â”‚


PASSO 2: SELEÃ‡ÃƒO DE DATA/HORA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚                    â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Seleciona data          â”‚
    â”‚                    â”‚                         â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ GET /available-slots
    â”‚                    â”‚                         â”‚ {serviceId, date range}
    â”‚                    â”‚                         â”‚
    â”‚                    â”‚  AvailabilityService   â”‚
    â”‚                    â”‚  - checkSlotAvailability()
    â”‚                    â”‚  - Valida horÃ¡rio      â”‚
    â”‚                    â”‚  - Verifica conflitos  â”‚
    â”‚                    â”‚                         â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Retorna slots
    â”‚ VÃª horÃ¡rios livres â”‚                         â”‚


PASSO 3: CONFIRMAÃ‡ÃƒO & DADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚                    â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Preenche formulÃ¡rio     â”‚
    â”‚ Nome, email,      â”‚ (name, phone, email)    â”‚
    â”‚ telefone          â”‚                         â”‚
    â”‚                    â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Clica "Confirmar"       â”‚
    â”‚                    â”‚                         â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ POST /bookings
    â”‚                    â”‚                         â”‚ {serviceId, professionalId,
    â”‚                    â”‚                         â”‚  date, time, customer_*}
    â”‚                    â”‚                         â”‚
    â”‚                    â”‚  Booking Service       â”‚
    â”‚                    â”‚  - Valida dados        â”‚
    â”‚                    â”‚  - Verifica polÃ­tica   â”‚
    â”‚                    â”‚  - Cria appointment    â”‚
    â”‚                    â”‚                         â”‚
    â”‚                    â”‚  Notification Service  â”‚
    â”‚                    â”‚  - Envia email âœ‰ï¸     â”‚
    â”‚                    â”‚                         â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Sucesso + Email
    â”‚ Confirmado! âœ…     â”‚                         â”‚


CANCELAMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚                    â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Clica "Cancelar"        â”‚
    â”‚                    â”‚                         â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ PATCH /bookings/:id/cancel
    â”‚                    â”‚                         â”‚
    â”‚                    â”‚  Booking Service       â”‚
    â”‚                    â”‚  - Verifica BookingPolicy
    â”‚                    â”‚  - Valida horas antes  â”‚
    â”‚                    â”‚  - Marca como CANCELLED
    â”‚                    â”‚                         â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Confirmado
    â”‚ Cancelado! âŒ      â”‚                         â”‚


REAGENDAMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚                    â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Clica "Reagendar"       â”‚
    â”‚                    â”‚                         â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (mesmo como PASSO 2)
    â”‚                    â”‚                         â”‚ GET /available-slots
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Novos slots
    â”‚ Seleciona novo     â”‚                         â”‚
    â”‚ horÃ¡rio            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ PATCH /bookings/:id/reschedule
    â”‚                    â”‚                         â”‚ {newDate, newTime}
    â”‚                    â”‚                         â”‚
    â”‚                    â”‚  Booking Service       â”‚
    â”‚                    â”‚  - Cria novo appointment
    â”‚                    â”‚  - Cancela o anterior  â”‚
    â”‚                    â”‚  - Vincula histÃ³rico   â”‚
    â”‚                    â”‚                         â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Confirmado
    â”‚ Reagendado! â™»ï¸     â”‚                         â”‚
```

## ðŸ“Š MODELOS DE DADOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TENANT (Multi-tenancy)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ id, name, slug, email, phone, address, ...               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                    â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚          â–¼                   â–¼                   â–¼               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  Professionalâ”‚   â”‚   Service    â”‚   â”‚    Client    â”‚      â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚    â”‚ id           â”‚   â”‚ id           â”‚   â”‚ id           â”‚      â”‚
â”‚    â”‚ name         â”‚   â”‚ name         â”‚   â”‚ name         â”‚      â”‚
â”‚    â”‚ email        â”‚   â”‚ description  â”‚   â”‚ email        â”‚      â”‚
â”‚    â”‚ phone        â”‚   â”‚ duration     â”‚   â”‚ phone        â”‚      â”‚
â”‚    â”‚ avatar       â”‚   â”‚ price        â”‚   â”‚ cpf          â”‚      â”‚
â”‚    â”‚ specialty    â”‚   â”‚ category     â”‚   â”‚ birthDate    â”‚      â”‚
â”‚    â”‚ isActive     â”‚   â”‚ isActive     â”‚   â”‚ address      â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚                   â”‚                   â”‚               â”‚
â”‚          â”‚                   â”‚                   â”‚               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                              â–¼                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚   Appointment    â”‚                          â”‚
â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚                    â”‚ id               â”‚                          â”‚
â”‚                    â”‚ date             â”‚                          â”‚
â”‚                    â”‚ startTime        â”‚                          â”‚
â”‚                    â”‚ endTime          â”‚                          â”‚
â”‚                    â”‚ status           â”‚                          â”‚
â”‚                    â”‚ notes            â”‚                          â”‚
â”‚                    â”‚                  â”‚ (NOVOS)                 â”‚
â”‚                    â”‚ customerPhone â—„â”€â”€â”¼â”€ Para agendamento      â”‚
â”‚                    â”‚ customerEmail â—„â”€â”€â”¼â”€  pÃºblico               â”‚
â”‚                    â”‚ originalAppointmentId â—„â”€ Para histÃ³rico    â”‚
â”‚                    â”‚ cancelledAt  â—„â”€â”€â”€â”¼â”€ Cancelamento          â”‚
â”‚                    â”‚ cancellationReason    â”‚                    â”‚
â”‚                    â”‚ confirmedAt      â”‚                          â”‚
â”‚                    â”‚ confirmationToken    â”‚                      â”‚
â”‚                    â”‚ rating, review   â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚          â–²                                                       â”‚
â”‚          â”‚                                                       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚   BookingPolicy      â”‚  (NOVO)                    â”‚
â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚            â”‚ id                   â”‚                             â”‚
â”‚            â”‚ tenantId (UNIQUE)    â”‚                             â”‚
â”‚            â”‚                      â”‚                             â”‚
â”‚            â”‚ allowCancellation    â”‚                             â”‚
â”‚            â”‚ minCancellationHours â”‚                             â”‚
â”‚            â”‚ maxCancellations/mon â”‚                             â”‚
â”‚            â”‚                      â”‚                             â”‚
â”‚            â”‚ allowRescheduling    â”‚                             â”‚
â”‚            â”‚ minReschedulingHours â”‚                             â”‚
â”‚            â”‚ maxReschedulings     â”‚                             â”‚
â”‚            â”‚                      â”‚                             â”‚
â”‚            â”‚ minAdvanceBookingHoursâ”‚                            â”‚
â”‚            â”‚ maxAdvanceBookingDaysâ”‚                             â”‚
â”‚            â”‚ slotDurationMinutes  â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                      â–²                                           â”‚
â”‚                      â”‚                                           â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚  AvailabilityRule    â”‚  (NOVO)                    â”‚
â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚            â”‚ id                   â”‚                             â”‚
â”‚            â”‚ professionalId (FK)  â”‚                             â”‚
â”‚            â”‚                      â”‚                             â”‚
â”‚            â”‚ dayOfWeek (0-6)      â”‚                             â”‚
â”‚            â”‚ startTime ("09:00")  â”‚                             â”‚
â”‚            â”‚ endTime ("18:00")    â”‚                             â”‚
â”‚            â”‚ isActive             â”‚                             â”‚
â”‚            â”‚                      â”‚                             â”‚
â”‚            â”‚ UNIQUE (prof, day)   â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ” VALIDAÃ‡Ã•ES & REGRAS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  VALIDAÃ‡Ã•ES DO SISTEMA                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£ DISPONIBILIDADE DE HORÃRIOS                                 â”‚
â”‚     âœ… HorÃ¡rio dentro do funcionamento (workStartTime/EndTime) â”‚
â”‚     âœ… HorÃ¡rio respeita AvailabilityRule do profissional       â”‚
â”‚     âœ… Slot nÃ£o conflita com agendamentos existentes           â”‚
â”‚     âœ… Data dentro do perÃ­odo permitido (adv/max booking)      â”‚
â”‚                                                                 â”‚
â”‚  2ï¸âƒ£ DURAÃ‡ÃƒO DO SERVIÃ‡O                                          â”‚
â”‚     âœ… Verifica se hÃ¡ espaÃ§o para a duraÃ§Ã£o (ex: 30 min)       â”‚
â”‚     âœ… NÃ£o permite slot que ultrapassa horÃ¡rio de fechamento   â”‚
â”‚                                                                 â”‚
â”‚  3ï¸âƒ£ CANCELAMENTO                                                â”‚
â”‚     âœ… BookingPolicy.allowCancellation === true                â”‚
â”‚     âœ… Horas atÃ© agendamento >= minCancellationHours           â”‚
â”‚     âœ… Contagem mensal <= maxCancellationsPerMonth             â”‚
â”‚     âœ… Status atual !== 'CANCELLED'                            â”‚
â”‚                                                                 â”‚
â”‚  4ï¸âƒ£ REAGENDAMENTO                                               â”‚
â”‚     âœ… BookingPolicy.allowRescheduling === true                â”‚
â”‚     âœ… Horas atÃ© agendamento >= minReschedulingHours           â”‚
â”‚     âœ… Reagendamentos <= maxReschedulings                      â”‚
â”‚     âœ… Novo horÃ¡rio deve estar disponÃ­vel                      â”‚
â”‚                                                                 â”‚
â”‚  5ï¸âƒ£ DADOS DO CLIENTE                                            â”‚
â”‚     âœ… Nome obrigatÃ³rio (min 3 caracteres)                     â”‚
â”‚     âœ… Telefone obrigatÃ³rio e vÃ¡lido (regex)                   â”‚
â”‚     âœ… Email vÃ¡lido se fornecido                               â”‚
â”‚                                                                 â”‚
â”‚  6ï¸âƒ£ SEGURANÃ‡A                                                   â”‚
â”‚     âœ… ValidaÃ§Ã£o de tenantId em cada request                   â”‚
â”‚     âœ… VerificaÃ§Ã£o de propriedade do agendamento               â”‚
â”‚     âœ… Rate limiting nos endpoints pÃºblicos                    â”‚
â”‚     âœ… Token de confirmaÃ§Ã£o Ãºnico                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸš€ STATUS ATUAL

```
âœ… DocumentaÃ§Ã£o Completa (2000+ linhas)
âœ… Script de ImplementaÃ§Ã£o AutomÃ¡tica
âœ… Exemplos de CÃ³digo TypeScript/React
âœ… Schema Prisma Pronto
âœ… ServiÃ§os (Availability + Notification)
âœ… Rotas REST da API
âœ… Componentes React
âœ… ValidaÃ§Ãµes e Regras de NegÃ³cio
â³ ImplementaÃ§Ã£o PrÃ¡tica (sua vez!)

Tempo Estimado: 8-12 horas
Dificuldade: MÃ©dio
BenefÃ­cio: Sistema completo de agendamento
```

---

**Diagrama criado em:** 22 de dezembro de 2025  
**Para:** AIGenda - Sistema Multi-tenant de Agendamentos  
**Baseado em:** DocumentaÃ§Ã£o "Bora agendar exemplo"
