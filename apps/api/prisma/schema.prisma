// This is your Prisma schema file,// This is your Prisma schema file,

// learn more about it in the docs: https://pris.ly/d/prisma-schema// learn more about it in the docs: https://pris.ly/d/prisma-schema



generator client {generator client {

  provider = "prisma-client-js"  provider = "prisma-client-js"

}  // Explicit output to avoid generator path resolution issues inside container.

  // The @prisma/client runtime expects the generated files under its own

datasource db {  // package path (node_modules/@prisma/client/.prisma/client). Configure the

  provider = "postgresql"  // generator to write directly into that location so `require('@prisma/client')`

  url      = env("DATABASE_URL")  // can find the generated client at runtime inside containers and Docker images.

}  // Output is relative to this schema file's directory.

  output = "../../node_modules/@prisma/client/.prisma/client"

// ============= TENANT (Multi-tenancy) =============}

model Tenant {

  id        String   @id @default(cuid())datasource db {

  name      String  provider = "postgresql"

  slug      String   @unique  url      = env("DATABASE_URL")

  logo      String?}

  email     String   @unique

  phone     String?// ============= TENANT (Multi-tenancy) =============

  address   String?model Tenant {

  city      String?  id        String   @id @default(cuid())

  state     String?  name      String

  zipCode   String?  slug      String   @unique

  country   String?  logo      String?

  website   String?  email     String   @unique

  createdAt DateTime @default(now())  phone     String?

  updatedAt DateTime @updatedAt  address   String?

  city      String?

  // Relations  state     String?

  users           User[]  zipCode   String?

  clients         Client[]  country   String?

  professionals   Professional[]  website   String?

  services        Service[]  createdAt DateTime @default(now())

  categories      Category[]  updatedAt DateTime @updatedAt

  products        Product[]

  suppliers       Supplier[]  // Relations

  packages        Package[]  users           User[]

  appointments    Appointment[]  clients         Client[]

  transactions    Transaction[]  professionals   Professional[]

  configs         Configuration?  services        Service[]

  subscriptions   Subscription?  appointments    Appointment[]

  transactions    Transaction[]

  @@index([slug])  configs         Configuration?

}  subscriptions   Subscription?



// ============= USUARIOS =============  @@index([slug])

model User {}

  id        String   @id @default(cuid())

  email     String   @unique// ============= USUARIOS =============

  name      Stringmodel User {

  password  String  id        String   @id @default(cuid())

  phone     String?  email     String   @unique

  avatar    String?  name      String

  role      Role     @default(USER)  password  String

  active    Boolean  @default(true)  phone     String?

  createdAt DateTime @default(now())  avatar    String?

  updatedAt DateTime @updatedAt  role      Role     @default(USER)

  active    Boolean  @default(true)

  // Multi-tenancy  createdAt DateTime @default(now())

  tenantId String  updatedAt DateTime @updatedAt

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // Multi-tenancy

  // Relations  tenantId String

  professional Professional? @relation("UserProfessional")  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  sessions     Session[]

  // Relations

  @@index([tenantId])  professional Professional? @relation("UserProfessional")

  @@index([email])  sessions     Session[]

}

  @@index([tenantId])

enum Role {  @@index([email])

  ADMIN}

  PROFESSIONAL

  USERenum Role {

}  ADMIN

  PROFESSIONAL

model Session {  USER

  id        String   @id @default(cuid())}

  token     String   @unique

  expiresAt DateTimemodel Session {

  createdAt DateTime @default(now())  id        String   @id @default(cuid())

  token     String   @unique

  // Relations  expiresAt DateTime

  userId String  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Relations

  @@index([userId])  userId String

}  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)



// ============= CADASTRO - CLIENTES =============  @@index([userId])

model Client {}

  id        String   @id @default(cuid())

  name      String// ============= CADASTRO - CLIENTES =============

  email     String?model Client {

  phone     String  id        String   @id @default(cuid())

  address   String?  name      String

  city      String?  email     String?

  cpf       String?  @unique  phone     String

  birthDate DateTime?  address   String?

  notes     String?  city      String?

  active    Boolean  @default(true)  cpf       String?  @unique

  createdAt DateTime @default(now())  birthDate DateTime?

  updatedAt DateTime @updatedAt  notes     String?

  active    Boolean  @default(true)

  // Multi-tenancy  createdAt DateTime @default(now())

  tenantId String  updatedAt DateTime @updatedAt

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // Multi-tenancy

  // Relations  tenantId String

  appointments Appointment[]  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  transactions Transaction[]

  // Relations

  @@index([tenantId])  appointments Appointment[]

  @@index([email])  transactions Transaction[]

}

  @@index([tenantId])

// ============= CADASTRO - PROFISSIONAIS =============  @@index([email])

model Professional {}

  id           String   @id @default(cuid())

  name         String// ============= CADASTRO - PROFISSIONAIS =============

  specialties  String[]model Professional {

  bio          String?  id           String   @id @default(cuid())

  avatar       String?  name         String

  rating       Float    @default(5)  specialties  String[] // Array de especialidades

  commissionRate Float  @default(0)  bio          String?

  active       Boolean  @default(true)  avatar       String?

  createdAt    DateTime @default(now())  rating       Float    @default(5)

  updatedAt    DateTime @updatedAt  commissionRate Float  @default(0) // Percentual de comissão

  active       Boolean  @default(true)

  // Multi-tenancy  createdAt    DateTime @default(now())

  tenantId String  updatedAt    DateTime @updatedAt

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // Multi-tenancy

  // Relations  tenantId String

  user         User? @relation("UserProfessional", fields: [userId], references: [id], onDelete: SetNull)  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  userId       String? @unique

  appointments Appointment[]  // Relations

  services     ServiceProfessional[]  user         User? @relation("UserProfessional", fields: [userId], references: [id], onDelete: SetNull)

  transactions Transaction[]  userId       String? @unique

  appointments Appointment[]

  @@index([tenantId])  services     ServiceProfessional[]

}  transactions Transaction[]



// ============= CADASTRO - CATEGORIAS =============  @@index([tenantId])

model Category {}

  id          String   @id @default(cuid())

  name        String// ============= CADASTRO - SERVIÇOS =============

  description String?model Service {

  color       String?  id           String   @id @default(cuid())

  icon        String?  name         String

  active      Boolean  @default(true)  description  String?

  createdAt   DateTime @default(now())  price        Float

  updatedAt   DateTime @updatedAt  duration     Int      // duração em minutos

  category     String?

  // Multi-tenancy  active       Boolean  @default(true)

  tenantId String  createdAt    DateTime @default(now())

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)  updatedAt    DateTime @updatedAt



  // Relations  // Multi-tenancy

  services Service[]  tenantId String

  products Product[]  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)



  @@index([tenantId])  // Relations

}  appointments Appointment[]

  professionals ServiceProfessional[]

// ============= CADASTRO - SERVIÇOS =============

model Service {  @@index([tenantId])

  id           String   @id @default(cuid())}

  name         String

  description  String?model ServiceProfessional {

  price        Float  id             String   @id @default(cuid())

  duration     Int      // duração em minutos  serviceId      String

  active       Boolean  @default(true)  service        Service        @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  createdAt    DateTime @default(now())  professionalId String

  updatedAt    DateTime @updatedAt  professional   Professional   @relation(fields: [professionalId], references: [id], onDelete: Cascade)

  createdAt      DateTime @default(now())

  // Multi-tenancy

  tenantId String  @@unique([serviceId, professionalId])

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)  @@index([serviceId])

  @@index([professionalId])

  // Relations}

  categoryId    String?

  category      Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)// ============= PRINCIPAL - AGENDAMENTOS =============

  appointments  Appointment[]model Appointment {

  professionals ServiceProfessional[]  id               String   @id @default(cuid())

  packageItems  PackageItem[]  title            String

  description      String?

  @@index([tenantId])  startTime        DateTime

  @@index([categoryId])  endTime          DateTime

}  status           AppointmentStatus @default(SCHEDULED)

  notes            String?

model ServiceProfessional {  reminderSent     Boolean  @default(false)

  id             String       @id @default(cuid())  reminderSentAt   DateTime?

  serviceId      String  canceledAt       DateTime?

  service        Service      @relation(fields: [serviceId], references: [id], onDelete: Cascade)  cancelReason     String?

  professionalId String  createdAt        DateTime @default(now())

  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)  updatedAt        DateTime @updatedAt

  createdAt      DateTime     @default(now())

  // Multi-tenancy

  @@unique([serviceId, professionalId])  tenantId String

  @@index([serviceId])  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([professionalId])

}  // Relations

  clientId       String

// ============= CADASTRO - PRODUTOS =============  client         Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)

model Product {  professionalId String

  id          String   @id @default(cuid())  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)

  name        String  serviceId      String

  description String?  service        Service    @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  price       Float  transaction    Transaction?

  costPrice   Float?

  sku         String?  @@index([tenantId])

  barcode     String?  @@index([clientId])

  stock       Int      @default(0)  @@index([professionalId])

  minStock    Int      @default(5)  @@index([startTime])

  active      Boolean  @default(true)}

  createdAt   DateTime @default(now())

  updatedAt   DateTime @updatedAtenum AppointmentStatus {

  SCHEDULED

  // Multi-tenancy  CONFIRMED

  tenantId String  COMPLETED

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)  CANCELED

  NO_SHOW

  // Relations}

  categoryId String?

  category   Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)// ============= FINANCEIRO - TRANSAÇÕES =============

  supplierId String?model Transaction {

  supplier   Supplier? @relation(fields: [supplierId], references: [id], onDelete: SetNull)  id               String   @id @default(cuid())

  type             TransactionType

  @@index([tenantId])  description      String

  @@index([categoryId])  amount           Float

}  status           TransactionStatus @default(PENDING)

  paymentMethod    String?

// ============= CADASTRO - FORNECEDORES =============  reference        String?  @unique

model Supplier {  notes            String?

  id        String   @id @default(cuid())  createdAt        DateTime @default(now())

  name      String  updatedAt        DateTime @updatedAt

  email     String?  paidAt           DateTime?

  phone     String?

  cnpj      String?  // Multi-tenancy

  address   String?  tenantId String

  city      String?  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  notes     String?

  active    Boolean  @default(true)  // Relations

  createdAt DateTime @default(now())  clientId       String?

  updatedAt DateTime @updatedAt  client         Client?    @relation(fields: [clientId], references: [id], onDelete: SetNull)

  professionalId String?

  // Multi-tenancy  professional   Professional? @relation(fields: [professionalId], references: [id], onDelete: SetNull)

  tenantId String  appointmentId  String?    @unique

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)  appointment    Appointment? @relation(fields: [appointmentId], references: [id], onDelete: SetNull)



  // Relations  @@index([tenantId])

  products Product[]  @@index([clientId])

  @@index([professionalId])

  @@index([tenantId])}

}

enum TransactionType {

// ============= PACOTES DE SERVIÇOS =============  INCOME      // Receita (cliente pagando)

model Package {  COMMISSION  // Comissão (profissional)

  id           String   @id @default(cuid())  EXPENSE     // Despesa

  name         String  REFUND      // Reembolso

  description  String?}

  price        Float

  validityDays Int      @default(30)enum TransactionStatus {

  active       Boolean  @default(true)  PENDING

  createdAt    DateTime @default(now())  CONFIRMED

  updatedAt    DateTime @updatedAt  FAILED

  REFUNDED

  // Multi-tenancy}

  tenantId String

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)// ============= PAGAMENTOS - STRIPE =============

model Subscription {

  // Relations  id                String   @id @default(cuid())

  items PackageItem[]  plan              SubscriptionPlan

  status            SubscriptionStatus @default(ACTIVE)

  @@index([tenantId])  stripeCustomerId  String?  @unique

}  stripeSubscriptionId String? @unique

  currentPeriodStart DateTime

model PackageItem {  currentPeriodEnd  DateTime

  id        String  @id @default(cuid())  canceledAt        DateTime?

  quantity  Int     @default(1)  createdAt         DateTime @default(now())

    updatedAt         DateTime @updatedAt

  // Relations

  packageId String  // Multi-tenancy

  package   Package @relation(fields: [packageId], references: [id], onDelete: Cascade)  tenantId String   @unique

  serviceId String  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([tenantId])

  @@unique([packageId, serviceId])}

  @@index([packageId])

  @@index([serviceId])enum SubscriptionPlan {

}  STARTER   // Básico - até 5 profissionais

  PRO       // Profissional - até 50 profissionais

// ============= PRINCIPAL - AGENDAMENTOS =============  ENTERPRISE // Empresarial - ilimitado

model Appointment {}

  id               String            @id @default(cuid())

  title            Stringenum SubscriptionStatus {

  description      String?  ACTIVE

  startTime        DateTime  PAST_DUE

  endTime          DateTime  CANCELED

  status           AppointmentStatus @default(SCHEDULED)  EXPIRED

  notes            String?}

  reminderSent     Boolean           @default(false)

  reminderSentAt   DateTime?// ============= CONFIGURAÇÕES =============

  canceledAt       DateTime?model Configuration {

  cancelReason     String?  id                    String   @id @default(cuid())

  createdAt        DateTime          @default(now())  businessHours         Boolean  @default(true)

  updatedAt        DateTime          @updatedAt  weekStartDay          Int      @default(0) // 0 = domingo, 1 = segunda

  appointmentDuration   Int      @default(60) // minutos

  // Multi-tenancy  bufferBetweenAppts    Int      @default(15) // minutos

  tenantId String  autoConfirmAppointments Boolean @default(false)

  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)  allowCancellation     Boolean  @default(true)

  cancellationDeadline  Int      @default(24) // horas

  // Relations  emailNotifications    Boolean  @default(true)

  clientId       String  smsNotifications      Boolean  @default(false)

  client         Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)  whatsappNotifications Boolean  @default(false)

  professionalId String  createdAt             DateTime @default(now())

  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)  updatedAt             DateTime @updatedAt

  serviceId      String

  service        Service      @relation(fields: [serviceId], references: [id], onDelete: Cascade)  // Multi-tenancy

  transaction    Transaction?  tenantId String   @unique

  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])

  @@index([clientId])  @@index([tenantId])

  @@index([professionalId])}

  @@index([startTime])
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  COMPLETED
  CANCELED
  NO_SHOW
}

// ============= FINANCEIRO - TRANSAÇÕES =============
model Transaction {
  id            String            @id @default(cuid())
  type          TransactionType
  description   String
  amount        Float
  status        TransactionStatus @default(PENDING)
  paymentMethod String?
  reference     String?           @unique
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  paidAt        DateTime?

  // Multi-tenancy
  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // Relations
  clientId       String?
  client         Client?       @relation(fields: [clientId], references: [id], onDelete: SetNull)
  professionalId String?
  professional   Professional? @relation(fields: [professionalId], references: [id], onDelete: SetNull)
  appointmentId  String?       @unique
  appointment    Appointment?  @relation(fields: [appointmentId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([clientId])
  @@index([professionalId])
}

enum TransactionType {
  INCOME
  COMMISSION
  EXPENSE
  REFUND
}

enum TransactionStatus {
  PENDING
  CONFIRMED
  FAILED
  REFUNDED
}

// ============= PAGAMENTOS - STRIPE =============
model Subscription {
  id                   String             @id @default(cuid())
  plan                 SubscriptionPlan
  status               SubscriptionStatus @default(ACTIVE)
  stripeCustomerId     String?            @unique
  stripeSubscriptionId String?            @unique
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  canceledAt           DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt

  // Multi-tenancy
  tenantId String @unique
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

enum SubscriptionPlan {
  STARTER
  PRO
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
}

// ============= CONFIGURAÇÕES =============
model Configuration {
  id                      String   @id @default(cuid())
  businessHours           Boolean  @default(true)
  weekStartDay            Int      @default(0)
  appointmentDuration     Int      @default(60)
  bufferBetweenAppts      Int      @default(15)
  autoConfirmAppointments Boolean  @default(false)
  allowCancellation       Boolean  @default(true)
  cancellationDeadline    Int      @default(24)
  emailNotifications      Boolean  @default(true)
  smsNotifications        Boolean  @default(false)
  whatsappNotifications   Boolean  @default(false)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Multi-tenancy
  tenantId String @unique
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}
